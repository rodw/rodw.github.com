<!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
  <title>8 node.js snippets</title>
	
	<meta name="author" content="rod">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
	<!--[if lt IE 9]>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

  
  <link rel="icon" type="image/svg+xml" href="img/braindump-mod.svg"/>
	<link rel="alternate shortcut icon" href="img/favicon.ico">
	<link rel="apple-touch-icon" sizes="57x57" href="img/braindump-57x57.png">
	<link rel="apple-touch-icon" sizes="72x72" href="img/braindump-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="img/braindump-114x114.png">
	<link rel="apple-touch-icon" sizes="144x144" href="img/braindump-144x144.png">
  <link rel="apple-touch-startup-image" sizes="320x460" href="img/startup-320x460.png">

	<link rel="stylesheet" href="/css/skeleton-all-min.css">
	<link rel="stylesheet" href="/css/style.min.css">

  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-34329491-1']);
    _gaq.push(['_trackPageview']);
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>

</head>

<body>

  

  <nav id="primary">
    <div class="container">
      <div class="fourteen columns offset-by-two">
        <ul>
          
            
            
            <li class="" >
              <a class="" href="/">Home</a>
            </li>
          
            
            
            <li class="" >
              <a class="" href="/project">Projects</a>
            </li>
          
            
            
            <li class="" >
              <a class="" href="/article">Articles</a>
            </li>
          
            
            
              
            
            <li class="active" >
              <a class="active" href="/snippet">Snippets</a>
            </li>
          
        </ul>
      </div>
    </div>
  </nav>

  

  <div id="mainbody">
    <div class="container">

      

      <div id="content-jump" class="align-center"><a href="#maincontent">Jump to content.</a></div>
      <div class="three columns align-center">
        <div style="margin-top:50px;"><a href="/"><img src="/img/braindump-64x64.png" height="64" width="64"></a></div>
        <div class="mtop"><a href="/" class="nobr nou" style="color:#555;"><b>Rodney Waldhoff</b></a></div>
        <ul class="mtop">
          <li><a class="flatbutton" title="github.com/rodw" href="https://github.com/rodw"><img style="vertical-align:middle; float:left;" src="/img/octocat-24x24.png" height="24" width="24"><span class="float-right">GitHub</span></a></li>
          <li><a class="flatbutton" title="Rod @ LinkedIn" href="http://www.linkedin.com/in/rwald"><img style="vertical-align:middle; float:left;" src="/img/linkedin-24x24.png" height="24" width="24"><span class="float-right">LinkedIn</span></a></a></li>
          <li><a class="flatbutton" title="Rod @ Twitter" href="https://twitter.com/RodWaldhoff"><img style="vertical-align:middle; float:left;" src="/img/twitter-24x24.png" height="24" width="24"><span class="float-right">Twitter</span></a></a></li>
          <li><a class="flatbutton" title="Rod @ StackOverflow" href="http://stackoverflow.com/users/1225825/rod"><img style="vertical-align:middle; float:left;" src="/img/stackoverflow-24x24.png" height="24" width="24"><span class="float-right">SOflow</span></a></a></li>
          <!--
          <li><a class="flatbutton" title="Rod @ Math.StackExchange" href="http://math.stackexchange.com/users/116929/rod"><img style="vertical-align:middle; float:left;" src="/img/math-stackexchange-24x24.png" height="24" width="24"><span class="float-right">Math@SE</span></a></a></li>
          <li><a class="flatbutton" title="Rod @ TeX.StackExchange" href="http://tex.stackexchange.com/users/37896/rod"><img style="vertical-align:middle; float:left;" src="/img/tex-stackexchange-24x24.png" height="24" width="24"><span class="float-right">TeX@SE</span></a></a></li>
          -->
          <li><a class="flatbutton" title="The Graphviz Cookbook" href="http://noumlaut.com/graphviz-cookbook"><img style="vertical-align:middle; float:left;" src="/img/noumlaut-24x24.png" height="24" width="24"><span class="float-right">GV Book</span></a></a></li>
          <li><a class="flatbutton" title="Resume/CV for Rodney Waldhoff (PDF)" href="/img/Waldhoff-Rodney-resume-2014-02.pdf"><img style="vertical-align:middle; float:left;" src="/img/rod-photo-grayscale-24x24.png" height="24" width="24"><span class="float-right">Resume</span></a></li>
        </ul>
      </div>

      <div class="thirteen columns"><a name="maincontent"></a></div>
      
      
      
      <div class="thirteen columns">
        <div id="page-header" class="half-bottom mtop">
          
            <h1 class=" remove-bottom">8 node.js snippets</h1>
          
          <div class="page-class remove-bottom">
            
                <a href="/snippet">Snippets</a> are tiny notes I've collected for easy reference.
              
          </div>
        </div>
        
      </div>
    
    
      <div class="thirteen columns bulleted">
        
  <div class="snippet">
    
      <a class="permalink" href="/snippet/s/mocha-1-17-coffeescript.html">
        <h2 class="half-bottom">Fixing "Unexpected string" errors with CoffeeScript 1.7 and Mocha 1.17</h2>
      </a>
    
    <div>
      <p>Recently I&rsquo;ve been running into the following error when testing CoffeeScript files using Mocha:</p>

<pre><code>(exports, require, module, __filename, __dirname) { should  = require 'should'
                                                                      ^^^^^^^^
SyntaxError: Unexpected string
</code></pre>

<p><a href="http://visionmedia.github.io/mocha/#compilers-option">The fix is described here on the mocha site.</a></p>

<blockquote><p>coffee-script is no longer supported out of the box. CS and similar transpilers may be
used by mapping the file extensions (for use with &ndash;watch) and the module name. For example
&ndash;compilers coffee:coffee-script with CoffeeScript 1.6- or
&ndash;compilers coffee:coffee-script/register with CoffeeScript 1.7+.</p></blockquote>

<p>In other words, to fix the problem change the argument:</p>

<pre><code>--compilers coffee:coffee-script
</code></pre>

<p>on your Mocha command line to:</p>

<pre><code>--compilers coffee:coffee-script/register
</code></pre>

    </div>
    <div class="align-right">
      <small>Tags: <a href="/snippet/t/coffeescript.html">coffeescript</a>, <a href="/snippet/t/node-js.html">node.js</a>, <a href="/snippet/t/mocha.html">mocha</a> and <a href="/snippet/t/debug.html">debug</a>.</small>
    </div>    
    
  </div>
  <!-- <hr/> -->

  <div class="snippet">
    
      <a class="permalink" href="/snippet/s/forever-service.html">
        <h2 class="half-bottom">Shell script for service-like CoffeeScript/Node.js apps using forever</h2>
      </a>
    
    <div>
      <p>This is an example of a (bash) shell script that uses the forever module to start and stop a CoffeeScript application as if it were a service.</p>

<script src="https://gist.github.com/rodw/8947415.js"></script>


<p>(Also at <a href="https://gist.github.com/rodw/8947415">rodw/coffee-as-a-service-via-forever.sh</a>.)</p>

    </div>
    <div class="align-right">
      <small>Tags: <a href="/snippet/t/coffeescript.html">coffeescript</a>, <a href="/snippet/t/node-js.html">node.js</a>, <a href="/snippet/t/bash.html">bash</a> and <a href="/snippet/t/gist.html">gist</a>.</small>
    </div>    
    
  </div>
  <!-- <hr/> -->

  <div class="snippet">
    
      <a class="permalink" href="/snippet/s/nodejs-sql-to-html.html">
        <h2 class="half-bottom">A General Purpose SQL-to-HTML Routine for CoffeeScript/JavaScript/Node.js</h2>
      </a>
    
    <div>
      <p>Using <a href="https://github.com/felixge/node-mysql">node-mysql</a> or similar, the following CoffeeScript routine will generate an HTML table containing the data in a SQL result set, including column headings:</p>

<div class="highlight"><pre><code class="coffeescript">  <span class="nx">sql_to_html</span><span class="o">:</span><span class="nf">(connection,query,bindvars,callback)=&gt;</span>
    <span class="nx">connection</span><span class="p">.</span><span class="nx">query</span> <span class="nx">query</span><span class="p">,</span> <span class="nx">bindvars</span><span class="p">,</span> <span class="nf">(err,rows,fields)=&gt;</span>
      <span class="k">if</span> <span class="nx">err</span><span class="o">?</span>
         <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
      <span class="k">else</span>
        <span class="nv">buffer = </span><span class="s">&#39;&lt;table border=1&gt;&lt;tr&gt;&#39;</span>
        <span class="k">for</span> <span class="nx">field</span> <span class="k">in</span> <span class="nx">fields</span>
          <span class="nx">buffer</span> <span class="o">+=</span> <span class="s">&quot;&lt;th&gt;</span><span class="si">#{</span><span class="nx">field</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="s">&lt;/th&gt;&quot;</span>
        <span class="nx">buffer</span> <span class="o">+=</span> <span class="s">&#39;&lt;/tr&gt;&#39;</span>
        <span class="k">for</span> <span class="nx">row</span> <span class="k">in</span> <span class="nx">rows</span>
          <span class="nx">buffer</span> <span class="o">+=</span> <span class="s">&#39;&lt;tr&gt;&#39;</span>
          <span class="k">for</span> <span class="nx">field</span> <span class="k">in</span> <span class="nx">fields</span>
            <span class="nx">buffer</span> <span class="o">+=</span> <span class="s">&quot;&lt;td&gt;</span><span class="si">#{</span><span class="nx">row</span><span class="p">[</span><span class="nx">field</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span><span class="si">}</span><span class="s">&lt;/td&gt;&quot;</span>
          <span class="nx">buffer</span> <span class="o">+=</span> <span class="s">&#39;&lt;/tr&gt;&#39;</span>
        <span class="nx">buffer</span> <span class="o">+=</span> <span class="s">&#39;&lt;/table&gt;&#39;</span>
        <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="nx">buffer</span><span class="p">)</span>
</code></pre></div>




    </div>
    <div class="align-right">
      <small>Tags: <a href="/snippet/t/coffeescript.html">coffeescript</a>, <a href="/snippet/t/node-js.html">node.js</a>, <a href="/snippet/t/sql.html">sql</a>, <a href="/snippet/t/mysql.html">mysql</a> and <a href="/snippet/t/html.html">html</a>.</small>
    </div>    
    
  </div>
  <!-- <hr/> -->

  <div class="snippet">
    
      <a class="permalink" href="/snippet/s/coffeescript-flatten-array.html">
        <h2 class="half-bottom">flatten an array in coffeescript</h2>
      </a>
    
    <div>
      

<div class="highlight"><pre><code class="coffeescript"><span class="nv">flatten_array = </span><span class="nf">(a)-&gt;</span>
  <span class="k">unless</span> <span class="nx">a</span><span class="o">?</span>
    <span class="k">return</span> <span class="kc">null</span>
  <span class="k">else</span> <span class="k">if</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="p">[]</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="p">(</span> <span class="nx">a</span><span class="p">.</span><span class="nx">reduce</span> <span class="nf">(l,r)-&gt;</span><span class="nx">l</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span> <span class="p">)</span>
</code></pre></div>




    </div>
    <div class="align-right">
      <small>Tags: <a href="/snippet/t/node-js.html">node.js</a>, <a href="/snippet/t/javascript.html">javascript</a> and <a href="/snippet/t/coffeescript.html">coffeescript</a>.</small>
    </div>    
    
  </div>
  <!-- <hr/> -->

  <div class="snippet">
    
      <a class="permalink" href="/snippet/s/node-js-process-on-sigint.html">
        <h2 class="half-bottom">gracefully closing node.js applications via signal handling</h2>
      </a>
    
    <div>
      <p>To make your node.js application gracefully respond to shutdown signals, use <code>process.on(SIGNAL,HANDLER)</code>.</p>

<p>For example, to respond to <code>SIGINT</code> (typically <em>Ctrl-c</em>), you can use:</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">process</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span> <span class="s2">&quot;SIGINT&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;CLOSING [SIGINT]&#39;</span><span class="p">);</span>
  <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">();</span>
<span class="p">}</span> <span class="p">);</span>
</code></pre></div>


<p>Note that without the <code>process.exit()</code>, the program will not be shutdown.  (This is you chance to override or &ldquo;trap&rdquo; the signal.)</p>

<p>Some common examples (in CoffeeScript):</p>

<div class="highlight"><pre><code class="coffeescript"><span class="nx">process</span><span class="p">.</span><span class="nx">on</span> <span class="s">&#39;SIGHUP&#39;</span><span class="p">,</span>  <span class="p">()</span><span class="nf">-&gt;</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s">&#39;CLOSING [SIGHUP]&#39;</span><span class="p">);</span>  <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">()</span>
<span class="nx">process</span><span class="p">.</span><span class="nx">on</span> <span class="s">&#39;SIGINT&#39;</span><span class="p">,</span>  <span class="p">()</span><span class="nf">-&gt;</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s">&#39;CLOSING [SIGINT]&#39;</span><span class="p">);</span>  <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">()</span>
<span class="nx">process</span><span class="p">.</span><span class="nx">on</span> <span class="s">&#39;SIGQUIT&#39;</span><span class="p">,</span> <span class="p">()</span><span class="nf">-&gt;</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s">&#39;CLOSING [SIGQUIT]&#39;</span><span class="p">);</span> <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">()</span>
<span class="nx">process</span><span class="p">.</span><span class="nx">on</span> <span class="s">&#39;SIGABRT&#39;</span><span class="p">,</span> <span class="p">()</span><span class="nf">-&gt;</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s">&#39;CLOSING [SIGABRT]&#39;</span><span class="p">);</span> <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">()</span>
<span class="nx">process</span><span class="p">.</span><span class="nx">on</span> <span class="s">&#39;SIGTERM&#39;</span><span class="p">,</span> <span class="p">()</span><span class="nf">-&gt;</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s">&#39;CLOSING [SIGTERM]&#39;</span><span class="p">);</span> <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">()</span>
</code></pre></div>


<p>PS: On Linux (and similar) you can enter <code>kill -l</code> on the command line to see a list of possible signals, and <code>kill -N PID</code> to send signal <em>N</em> to the process with process ID <em>PID</em>.</p>

    </div>
    <div class="align-right">
      <small>Tags: <a href="/snippet/t/node-js.html">node.js</a>, <a href="/snippet/t/javascript.html">javascript</a> and <a href="/snippet/t/coffeescript.html">coffeescript</a>.</small>
    </div>    
    
  </div>
  <!-- <hr/> -->

  <div class="snippet">
    
      <a class="permalink" href="/snippet/s/nodejs-require-main.html">
        <h2 class="half-bottom">Check `require.main` to test if a Node.js file is run directly</h2>
      </a>
    
    <div>
      <p>In Node, when a file is run directly from the command line, <code>require.main</code> is set to its <code>module</code>. Hence <code>require.main === module</code> tells you whether or not your script was invoked directly or required by another file.</p>

<p>A JavaScript &ldquo;main&rdquo; idiom:</p>

<div class="highlight"><pre><code class="javascript"><span class="err">#</span><span class="o">!</span><span class="err">/usr/bin/env node</span>
<span class="err">#</span> <span class="nx">file</span><span class="o">:</span> <span class="nx">example</span><span class="p">.</span><span class="nx">js</span>

<span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>

<span class="k">if</span><span class="p">(</span><span class="nx">require</span><span class="p">.</span><span class="nx">main</span> <span class="o">===</span> <span class="nx">module</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">main</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>


<p>The <code>main</code> method will run if <code>example.js</code> is invoked via <code>node example.js</code> or <code>./example.js</code> but not when required within another script (via <code>require('./example')</code>, for example).</p>

<p>A CoffeeScript &ldquo;main&rdquo; idiom (using classes, although it doesn&rsquo;t have to):</p>

<div class="highlight"><pre><code class="coffeescript"><span class="c1">#!/usr/bin/env coffee</span>
<span class="c1"># file: example.coffee</span>
<span class="k">class</span> <span class="nx">Example</span>
  <span class="nx">main</span><span class="o">:</span><span class="p">()</span><span class="nf">-&gt;</span>
    <span class="c1"># ...</span>

<span class="k">if</span> <span class="nx">require</span><span class="p">.</span><span class="nx">main</span> <span class="o">is</span> <span class="nx">module</span>
  <span class="p">(</span><span class="k">new</span> <span class="nx">Example</span><span class="p">()).</span><span class="nx">main</span><span class="p">()</span>
</code></pre></div>


<p>The <code>main</code> method will run if <code>example.coffee</code> is invoked via <code>coffee example.coffee</code> or <code>./example.coffee</code> but not when required within another script (via <code>require('./example')</code>, for example).</p>

    </div>
    <div class="align-right">
      <small>Tags: <a href="/snippet/t/node-js.html">node.js</a>, <a href="/snippet/t/javascript.html">javascript</a>, <a href="/snippet/t/coffeescript.html">coffeescript</a> and <a href="/snippet/t/cli.html">cli</a>.</small>
    </div>    
    <div class="align-right"><small>Credit: Via <a href="http://nodejs.org/docs/v0.4.8/api/all.html#accessing_the_main_module">the nodejs.org docs</a>.</small></div>
  </div>
  <!-- <hr/> -->

  <div class="snippet">
    
      <a class="permalink" href="/snippet/s/argv-underscore-in-optimist.html">
        <h2 class="half-bottom">In node-optimist, `argv._` is an array of the "extra" parameters</h2>
      </a>
    
    <div>
      <p>In substack&rsquo;s <a href="https://github.com/substack/node-optimist">node-optimist</a>, you can use <code>argv._</code> to fetch any parameters remaining after optimist has done its parsing.</p>

<p>For example (in CoffeeScript):</p>

<div class="highlight"><pre><code class="coffeescript"><span class="c1"># file: example.coffee</span>
<span class="nv">optimist = </span><span class="nx">require</span> <span class="s">&#39;optimist&#39;</span>
<span class="nv">options = </span><span class="p">{</span>
  <span class="s">&#39;help&#39;</span> <span class="o">:</span> <span class="p">{</span> <span class="nx">description</span><span class="o">:</span><span class="s">&#39;Show this message and exit.&quot;, boolean:true , alias:&#39;</span><span class="nx">h</span><span class="s">&#39; }</span>
<span class="s">}</span>
<span class="s">argv = optimist.usage(&#39;</span><span class="nv">Usage: </span><span class="nx">$0</span> <span class="p">[</span><span class="o">--</span><span class="nx">help</span><span class="p">]</span><span class="s">&#39;, options).argv</span>

<span class="s"># Now argv._ contains an array &quot;extra&quot; parameters, if any</span>
<span class="s">console.log argv._</span>
</code></pre></div>


<p>For example</p>

<div class="highlight"><pre><code class="console"><span class="go">coffee example.coffee --help</span>
</code></pre></div>


<p>yields</p>

<div class="highlight"><pre><code class="javascript"><span class="p">[</span> <span class="p">]</span>
</code></pre></div>


<p>but either of</p>

<div class="highlight"><pre><code class="console"><span class="go">coffee example.coffee --help foo.txt bar.png</span>
</code></pre></div>


<p>or</p>

<div class="highlight"><pre><code class="console"><span class="go">coffee example.coffee foo.txt bar.png</span>
</code></pre></div>


<p>yield</p>

<div class="highlight"><pre><code class="javascript"><span class="p">[</span> <span class="s1">&#39;foo.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;bar.png&#39;</span> <span class="p">]</span>
</code></pre></div>




    </div>
    <div class="align-right">
      <small>Tags: <a href="/snippet/t/node-js.html">node.js</a>, <a href="/snippet/t/javascript.html">javascript</a>, <a href="/snippet/t/coffeescript.html">coffeescript</a> and <a href="/snippet/t/node-optimist.html">node-optimist</a>.</small>
    </div>    
    
  </div>
  <!-- <hr/> -->

  <div class="snippet">
    
      <a class="permalink" href="/snippet/s/argf-for-nodejs.html">
        <h2 class="half-bottom">Ruby-like ARGF for Node.js</h2>
      </a>
    
    <div>
      <p>tokuhirom&rsquo;s <a href="https://github.com/tokuhirom/node-argf">node-argf</a> module offers a Ruby-like ARGF for Node.js.</p>

<p>Install via:</p>

<div class="highlight"><pre><code class="console"><span class="go">npm install argf</span>
</code></pre></div>


<p>or by adding</p>

<div class="highlight"><pre><code class="json"><span class="p">{</span>
  <span class="err">...</span>
  <span class="nt">&quot;dependencies&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="err">...</span>
    <span class="nt">&quot;argf&quot;</span> <span class="p">:</span> <span class="s2">&quot;latest&quot;</span>
  <span class="p">}</span>
  <span class="err">...</span>
<span class="p">}</span>
</code></pre></div>


<p>to your <code>package.json</code> file.</p>

<p>Use ARGF like this:</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">ARGF</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;argf&#39;</span><span class="p">);</span>
<span class="nx">argf</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ARGF</span><span class="p">();</span>  <span class="c1">// create argf based on current</span>
                    <span class="c1">// command line parameters or</span>
                    <span class="c1">// input streams.</span>

<span class="c1">// register a callback for when all input data has been read</span>
<span class="nx">argf</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;finished&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Done processing all inputs.&quot;</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// process the input(s)</span>
<span class="nx">argf</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span><span class="nx">line</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Read:&quot;</span><span class="p">,</span><span class="nx">line</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;From source:&quot;</span><span class="p">,</span><span class="nx">argv</span><span class="p">.</span><span class="nx">stream</span><span class="p">.</span><span class="nx">path</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>


<p>Like Ruby&rsquo;s <code>ARGF</code>, the module assumes any elements in <code>process.argv</code> represent files to process (and uses the input stream if no files are provided.</p>

<p>You can also pass an array to <code>new ARGF()</code> to provide the list of files, which is handy if you&rsquo;re using something like <a href="https://github.com/substack/node-optimist">node-optimist</a>.  (Note that in node-optimist you can use <code>argv._</code> to get the remaining parameters after parsing.)  For example:</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">optimist</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;optimist&#39;</span><span class="p">);</span>
<span class="nx">ARGF</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;argf&#39;</span><span class="p">);</span>

<span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
  <span class="err">#</span> <span class="p">...</span>
<span class="p">}</span>
<span class="nx">argv</span> <span class="o">=</span> <span class="nx">optimist</span><span class="p">.</span><span class="nx">usage</span><span class="p">(</span><span class="s1">&#39;Usage: $0 ...&#39;</span><span class="p">,</span> <span class="nx">options</span><span class="p">).</span><span class="nx">argv</span><span class="p">;</span>

<span class="nx">argf</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ARGF</span><span class="p">(</span><span class="nx">argv</span><span class="p">.</span><span class="nx">_</span><span class="p">);</span>

<span class="nx">argf</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;finished&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Done processing all inputs.&quot;</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// process the input(s)</span>
<span class="nx">argf</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span><span class="nx">line</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Read:&quot;</span><span class="p">,</span><span class="nx">line</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;From source:&quot;</span><span class="p">,</span><span class="nx">argv</span><span class="p">.</span><span class="nx">stream</span><span class="p">.</span><span class="nx">path</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>




    </div>
    <div class="align-right">
      <small>Tags: <a href="/snippet/t/node-js.html">node.js</a>, <a href="/snippet/t/javascript.html">javascript</a>, <a href="/snippet/t/coffeescript.html">coffeescript</a> and <a href="/snippet/t/ruby.html">ruby</a>.</small>
    </div>    
    
  </div>
  <!-- <hr/> -->



        
            <div style="text-align:right; color: rgb(119, 119, 119); font-size: 12px;"><a href="/snippet">Snippets</a> are tiny notes I've collected for easy reference.</div>
          
      </div>
    </div>
  </div>

  

  <div id="footer">
    <div class="container">
      <div class="sixteen columns align-center">
        <p class="half-bottom">
          <span class="nobr">rw&#97;ldho<script language="javascript">(function(){var f=function(c) { document.write(String.fromCharCode(c)); }; f(0146); f(0x66); f(0100); })();</script>g&#109;ail&#46;com</span>
          &nbsp;|&nbsp;
          <span class="nobr">(&#55;03) 593-2<script language="javascript">document.write("3"); document.write((3-2+1)+"");</script>9</span>
        </p>
        <p class="half-bottom">
          <span class="nobr"><a href="/">heyrod.com</a></span>
          &nbsp;|&nbsp;
          <span class="nobr"><a href="/page/colophon.html">credits</a></span>
        </p>
        <p class="half-bottom">&copy; Copyright 2012-2014 Rodney Waldhoff.</p>
        <div id="caveator">
          <p class="smallprint">This page was generated at  1:29 PM on 25 February 2014</p>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
