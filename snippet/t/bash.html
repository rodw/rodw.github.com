<!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
  <title>5 bash snippets</title>
	
	<meta name="author" content="rod">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
	<!--[if lt IE 9]>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

  
  <link rel="icon" type="image/svg+xml" href="img/braindump-mod.svg"/>
	<link rel="alternate shortcut icon" href="img/favicon.ico">
	<link rel="apple-touch-icon" sizes="57x57" href="img/braindump-57x57.png">
	<link rel="apple-touch-icon" sizes="72x72" href="img/braindump-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="img/braindump-114x114.png">
	<link rel="apple-touch-icon" sizes="144x144" href="img/braindump-144x144.png">
  <link rel="apple-touch-startup-image" sizes="320x460" href="img/startup-320x460.png">

  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-34329491-1']);
    _gaq.push(['_trackPageview']);
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>

</head>

<body>

  

  <nav id="primary">
    <div class="container">
      <div class="fourteen columns offset-by-two">
        <ul>
          
            
            
            <li class="" >
              <a class="" href="/">Home</a>
            </li>
          
            
            
            <li class="" >
              <a class="" href="/project">Projects</a>
            </li>
          
            
            
              
            
            <li class="active" >
              <a class="active" href="/snippet">Snippets</a>
            </li>
          
        </ul>
      </div>
    </div>
  </nav>

  

  <div id="main">
    <div class="container">

      

      <div class="three columns align-center">
        <div style="margin-top:50px;"><a href="/"><img src="/img/braindump-64x64.png" height="64" width="64"></a></div>
        <div class="mtop"><a href="/" class="nobr nou" style="color:#555;"><b>Rodney Waldhoff</b></a></div>
        <ul class="mtop">
          <li><a class="flatbutton" title="github.com/rodw" href="https://github.com/rodw"><img style="vertical-align:middle; float:left;" src="/img/octocat-24x24.png" height="24" width="24"><span class="float-right">GitHub</span></a></li>
          <li><a class="flatbutton" title="Rod @ LinkedIn" href="http://www.linkedin.com/in/rwald"><img style="vertical-align:middle; float:left;" src="/img/linkedin-24x24.png" height="24" width="24"><span class="float-right">LinkedIn</span></a></a></li>
          <li><a class="flatbutton" title="Rod @ StackOverflow" href="http://stackoverflow.com/users/1225825/rod"><img style="vertical-align:middle; float:left;" src="/img/stackoverflow-24x24.png" height="24" width="24"><span class="float-right">SOflow</span></a></a></li>
          <li><a class="flatbutton" title="Rod @ Math.StackExchange" href="http://math.stackexchange.com/users/116929/rod"><img style="vertical-align:middle; float:left;" src="/img/math-stackexchange-24x24.png" height="24" width="24"><span class="float-right">Math@SE</span></a></a></li>
          <li><a class="flatbutton" title="Rod @ TeX.StackExchange" href="http://tex.stackexchange.com/users/37896/rod"><img style="vertical-align:middle; float:left;" src="/img/tex-stackexchange-24x24.png" height="24" width="24"><span class="float-right">TeX@SE</span></a></a></li>
          <li><a class="flatbutton" title="The Graphviz Cookbook" href="http://noumlaut.com/graphviz-cookbook"><img style="vertical-align:middle; float:left;" src="/img/noumlaut-24x24.png" height="24" width="24"><span class="float-right">GV Book</span></a></a></li>
        </ul>
      </div>

      

      

      
        <div class="thirteen columns">
          <div id="page-header" class="half-bottom mtop">
            
              <h1 class=" remove-bottom">5 bash snippets</h1>
            
            <div class="page-class remove-bottom">
              
                  <a href="/snippet">Snippets</a> are tiny notes I've collected for easy reference.
                
            </div>
          </div>
          
        </div>
      

      

      <div class="thirteen columns bulleted">
        
  <div class="snippet">
    
      <a class="permalink" href="/snippet/s/toggle-line-wrapping-in-terminal.html">
        <h2 class="half-bottom">Toggle line-wrapping in terminal with `tput rmam` and `tput sram`</h2>
      </a>
    
    <div>
      <p>The command:</p>

<div class="highlight"><pre><code class="console"><span class="go">tput rmam</span>
</code></pre></div>


<p>will disable line wrapping so that long lines are truncated to width of the terminal (<code>$COLUMNS</code>).</p>

<p>The command:</p>

<div class="highlight"><pre><code class="console"><span class="go">tput smam</span>
</code></pre></div>


<p>will re-enable it.</p>

<p>This seems to known as &ldquo;automatic margin&rdquo; mode, hence <code>smam</code> is <code>enter_am_mode</code> and <code>rmam</code> is <code>exit_am_mode</code>.</p>

<p>Some terminals may not support this functionality.</p>

    </div>
    <div class="align-right">
      <small>Tags: <a href="/snippet/t/bash.html">bash</a> and <a href="/snippet/t/linux.html">linux</a>.</small>
    </div>    
    
  </div>
  <!-- <hr/> -->

  <div class="snippet">
    
      <a class="permalink" href="/snippet/s/less-chop-long-lines.html">
        <h2 class="half-bottom">Use `less -S` for horizontal scrolling</h2>
      </a>
    
    <div>
      <p>The flag <code>-S</code> (or <code>--chop-long-lines</code>) will cause <code>less</code> to truncate lines at the screen (terminal) boundary, rather than wrapping as it does by default.  You can then scroll horizontally (with the arrow keys, for example) to view the full lines when needed.</p>

<div class="highlight"><pre><code class="console"><span class="go">cat some_file_with_very_long_lines | less -S</span>
</code></pre></div>




    </div>
    <div class="align-right">
      <small>Tags: <a href="/snippet/t/bash.html">bash</a> and <a href="/snippet/t/linux.html">linux</a>.</small>
    </div>    
    
  </div>
  <!-- <hr/> -->

  <div class="snippet">
    
      <a class="permalink" href="/snippet/s/how-to-right-align-bash-prompt.html">
        <h2 class="half-bottom">How to right-align text in your bash prompt</h2>
      </a>
    
    <div>
      <h3>Right aligning text by padding with spaces</h3>

<p>To have text in your bash prompt (<code>$PS1</code>) hug the right side of the terminal:</p>

<div class="highlight"><pre><code class="console"><span class="go">PS1=&quot;`printf &quot;%${COLUMNS}s\n&quot; &quot;${TEXT}&quot;`$PS1&quot;</span>
</code></pre></div>


<p>(This assumes you want the right-aligned text to appear before the rest of your prompt, if any.  Move the <code>$PS1</code> bit to the left side of the string to have the right-aligned text appear after the rest of your prompt.)</p>

<p>The <code>${COLUMNS}</code> variable contains the number of columns in the current terminal (it should change if you resize the terminal).  The <code>${TEXT}</code> variable is a placeholder for the text you want to right-align.</p>

<p>The trick here is to use <code>printf</code> to left-pad the string to given width.  <code>printf "%ns" "text"</code> will left-pad the given string (here, <code>text</code>) with spaces until the entire string is <em>n</em> characters wide.</p>

<h3>Right aligning text by padding with something other than space.</h3>

<p>Say you want to pad with <code>-</code> instead of space.  Try:</p>

<div class="highlight"><pre><code class="console"><span class="go">PS1=&quot;`printf -vch &quot;%${COLUMNS}s&quot; &quot;${TEXT}&quot;; printf &quot;%s&quot; &quot;${ch// /-}&quot;`$PS1&quot;</span>
</code></pre></div>


<p>This will left-pad the <code>${TEXT}</code> with spaces, as above, and then replace any spaces with <code>#</code>.</p>

<p>If you have any spaces in <code>${TEXT}</code> you want to preserve, one hacky work-around is to mark spaces in <code>$TEXT</code> with some other character, say <code>_</code>, and then replace <code>_</code> with <code></code> <em>after</em> the other substitution:</p>

<div class="highlight"><pre><code class="console"><span class="go">PS1=&quot;$PS1`printf -vch &quot;%${COLUMNS}s&quot; &quot;${TEXT}&quot;; printf -vch &quot;%s&quot; &quot;${ch// /-}&quot;; printf &quot;%s\n&quot; &quot;${ch//_/ }&quot;`&quot;</span>
</code></pre></div>


<h3>Drawing a line to the end of the line</h3>

<p>I recently added a line containing the date and time to my bash prompt (so I can tell when a given command completed) and wanted to draw a line across the rest of the screen to make it visually easier to tell where a new prompt is displayed.  Something like this:</p>

<div class="highlight"><pre><code class="text">-- Tue 02-Oct-2012 05:19 PM --------------------------------
</code></pre></div>


<p>(Assuming the terminal is 60 characters wide.)</p>

<p>Here&rsquo;s how I did it.</p>

<p>Within my <code>$PROMPT_COMMAND</code> I execute the following:</p>

<div class="highlight"><pre><code class="text">line=&quot;`printf -vch &quot;%${COLUMNS}s&quot; &quot;&quot;; printf &quot;%s&quot; &quot;${ch// /-}&quot;`&quot;
dts=&quot;`date +&quot;-- %a %d-%b-%Y %I:%M %p &quot;`&quot;
PS1=&quot;$PS1\e[1m\e[32m${dts}${line:${#dts}}&quot;
</code></pre></div>


<p>The first line creates a variable (<code>$line</code>) with <code>${COLUMNS}</code> dashes (<code>-</code>).  This line would span the length of the terminal.</p>

<p>The second line creates a variable (<code>$dts</code>) with my date and time format of choice (prefixed with <code>--</code> just for kicks).</p>

<p>The <code>${dts}${line:${#dts}}</code> bit in the third line displays my date and time string (<code>$dts</code>) and then a substring of <code>$line</code>, starting at the length of my date and time string (<code>${#dts}</code>).  (In this particular case <code>${dts}</code> is always exactly 28 characters long, so that value could be hard-coded but this way it works in the general case too.)</p>

<p>If you are curious, the <code>\e[1m\e[32m</code> bit makes the text bold (<code>\e[1m</code>) and green (<code>\e[32m</code>).</p>

    </div>
    <div class="align-right">
      <small>Tags: <a href="/snippet/t/bash.html">bash</a>, <a href="/snippet/t/bash-prompt.html">bash-prompt</a> and <a href="/snippet/t/linux.html">linux</a>.</small>
    </div>    
    
  </div>
  <!-- <hr/> -->

  <div class="snippet">
    
      <a class="permalink" href="/snippet/s/find-large-files.html">
        <h2 class="half-bottom">Find large files on Linux.</h2>
      </a>
    
    <div>
      <p><strong>UPDATE:</strong> Reader Luc Pionchon points out that <code>sort</code> supports a <code>-h</code> parameter that sorts by &ldquo;human&rdquo; numbers, hence:</p>

<div class="highlight"><pre><code class="console"><span class="gp">$</span> du -h * <span class="p">|</span> sort -h <span class="p">|</span> tail
</code></pre></div>


<p>is probably a better alternative than any of the following.</p>

<p><strike></p>

<div class="highlight"><pre><code class="console"><span class="gp">$</span> du -h * <span class="p">|</span> grep <span class="s2">&quot;^[0-9.]*M&quot;</span> <span class="p">|</span> sort -n
</code></pre></div>


<p>This finds files at least 1 MB in size and then sorts them by size.  Change <code>M</code> to <code>G</code> for files at least 1 GB in size.</p>

<p>(Caveat: files 1 GB or larger will be missed by the MB version.  You can use:</p>

<div class="highlight"><pre><code class="console"><span class="gp">$</span> du -h * <span class="p">|</span> egrep <span class="s2">&quot;^[0-9.]*(M|G)&quot;</span>
</code></pre></div>


<p>to get both, but then the <code>sort -n</code> doesn&rsquo;t work quite the way we&rsquo;d like.)</p>

<p>Of course, you could use <code>du</code> without the <code>-h</code> to get file sizes by the default block size rather than the human-readable 12.4M or 16K, etc.
</strike></p>

    </div>
    <div class="align-right">
      <small>Tags: <a href="/snippet/t/linux.html">linux</a> and <a href="/snippet/t/bash.html">bash</a>.</small>
    </div>    
    <div class="align-right"><small>Credit: Thanks to Luc Pionchon for pointing me to `sort -h`.</small></div>
  </div>
  <!-- <hr/> -->

  <div class="snippet">
    
      <a class="permalink" href="/snippet/s/always-append-bash-history.html">
        <h2 class="half-bottom">Append to ~/.bash_history "immediately"</h2>
      </a>
    
    <div>
      <p>Bash normally waits until a session (terminal) is closed before it writes commands to the history.</p>

<p>You can add a call to <code>history -a</code> to <code>PROMPT_COMMAND</code> to make bash to append your history to <code>~/.bash_history</code> every time it displays your prompt.</p>

<div class="highlight"><pre><code class="console"><span class="go">PROMPT_COMMAND=&quot;history -a; $PROMPT_COMMAND&quot;</span>
</code></pre></div>


<p>The environment variable <code>PROMPT_COMMAND</code> is executed when bash is about to display your prompt.</p>

<p>The command <code>history -a</code> appends the current history to <code>~/.bash_history</code>.</p>

    </div>
    <div class="align-right">
      <small>Tags: <a href="/snippet/t/bash.html">bash</a> and <a href="/snippet/t/linux.html">linux</a>.</small>
    </div>    
    
  </div>
  <!-- <hr/> -->



      </div>

    </div>
  </div>

  

  <div id="footer">
    <div class="container">
      <div class="sixteen columns align-center">
        <p class="half-bottom">
          <span class="nobr">rw&#97;ldho<script language="javascript">(function(){var f=function(c) { document.write(String.fromCharCode(c)); }; f(0146); f(0x66); f(0100); })();</script>g&#109;ail&#46;com</span>
          &nbsp;|&nbsp;
          <span class="nobr">(&#55;03) 5&#51;5-6<script language="javascript">document.write("0"); document.write((4-3+1)+"");</script>6</span>
        </p>
        <p class="half-bottom">
          <span class="nobr"><a href="/">heyrod.com</a></span>
          &nbsp;|&nbsp;
          <span class="nobr"><a href="/page/colophon.html">credits</a></span>
        </p>
        <p class="half-bottom">&copy; Copyright 2012-2014 Rodney Waldhoff.</p>
        <div id="caveator">
          <p class="smallprint">This page was generated at  4:08 PM on 01 January 2014</p>
        </div>
      </div>
    </div>
  </div>
	<link rel="stylesheet" href="/css/skeleton-all-min.css">
	<link rel="stylesheet" href="/css/style.min.css">
</body>
</html>
